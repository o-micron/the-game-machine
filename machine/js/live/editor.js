var show_renderer=!1,that=null;function switchCanvas(){var t=document.getElementById("iframe-shell"),a=document.getElementById("canvas-renderer");(show_renderer=!show_renderer)?(a.height=t.height,a.classList.remove("d-none"),t.classList.add("d-none")):(t.height=a.height,t.classList.remove("d-none"),a.classList.add("d-none"))}!function(){var t=document.getElementById("canvas-parent"),a=document.getElementById("iframe-shell"),e=document.getElementById("canvas-renderer");a.width=t.offsetWidth,a.height=t.offsetHeight,e.width=t.offsetWidth,e.height=t.offsetHeight;var n=document.getElementById("playground"),i=document.getElementById("editor-tabs"),o=document.getElementById("editor-tabs-parent").offsetHeight,d=i.offsetHeight;n.style.height=o-d+"px",$("#playground div:first-child").addClass("h-100")}();class GameMachineEditor{constructor(){this.editor=null,this.data={c:{name:"c",model:null,state:null,downloaded:!1},python:{name:"python",model:null,state:null,downloaded:!1},js:{name:"js",model:null,state:null,downloaded:!1}},this.data.c.model=monaco.editor.createModel('#include <stdio.h>\n\nint main() {\n\tprintf("Hello world\\n");\n\treturn 0;\n}',"c"),this.data.python.model=monaco.editor.createModel('print("Hello world")',"python"),this.data.js.model=monaco.editor.createModel('console.log("hi")',"javascript"),this.li_id="c-ui-li",this.a_id="c-ui-a",this.programmingLanguage=this.data.c;var t=document.getElementById("playground");this.editor=monaco.editor.create(t,{model:this.data.c.model,minimap:{enabled:!1},roundedSelection:!1,scrollBeyondLastLine:!1}),this.binding=this.editor.addCommand(monaco.KeyMod.CtrlCmd|monaco.KeyCode.KEY_S,function(){onEditorRun()}),this.getProgrammingLanguage=function(){return this.programmingLanguage.name},this.hasCompiler=function(){return!0===this.programmingLanguage.downloaded},this.download=(()=>{onBeginDownloadAnimation();var t="";this.programmingLanguage===this.data.c?t="wapm install clang":this.programmingLanguage===this.data.js?t="wapm install quickjs":this.programmingLanguage===this.data.python&&(t="wapm install python"),execute(t).then(t=>{this.programmingLanguage.downloaded=!0,onEndAnimation(),onEditorRun()})}),this.run=(()=>{this.editor.saveViewState();var t=this.editor.getModel();if(t===this.data.c.model){cleanBuildFiles(["main.o","main.wasm"]);var a="wapm run clang -cc1 -triple wasm32-unkown-wasi -isysroot /sys -internal-isystem /sys/include -emit-obj main.c -o main.o";onBeginBuildingAnimation(),execute(a).then(t=>{execute(a="wapm run wasm-ld -L/sys/lib/wasm32-wasi /sys/lib/wasm32-wasi/crt1.o main.o -lc -o main.wasm").then(t=>{execute(a="wasmer main.wasm").then(t=>{onEndAnimation()})})})}else if(t===this.data.js.model){a="wapm run quickjs ./main.js";onBeginBuildingAnimation(),execute(a).then(t=>{onEndAnimation()})}else if(t===this.data.python.model){a="wapm run python ./main.py";onBeginBuildingAnimation(),execute(a).then(t=>{onEndAnimation()})}}),this.changeTab=(t=>{var a=this.editor.saveViewState(),e=this.editor.getModel();e===this.data.c.model?this.data.c.state=a:e===this.data.js.model?this.data.js.state=a:e===this.data.python.model&&(this.data.python.state=a),$("#"+this.li_id).removeClass("active"),$("#"+this.a_id).removeClass("active"),"c"===t?(this.programmingLanguage=this.data.c,this.editor.setModel(this.data.c.model),this.editor.restoreViewState(this.data.c.state),this.editor.focus(),this.li_id="c-ui-li",this.a_id="c-ui-a"):"javascript"===t?(this.programmingLanguage=this.data.js,this.editor.setModel(this.data.js.model),this.editor.restoreViewState(this.data.js.state),this.editor.focus(),this.li_id="js-ui-li",this.a_id="js-ui-a"):"python"===t&&(this.programmingLanguage=this.data.python,this.editor.setModel(this.data.python.model),this.editor.restoreViewState(this.data.python.state),this.editor.focus(),this.li_id="python-ui-li",this.a_id="python-ui-a"),$("#"+this.li_id).addClass("active"),$("#"+this.a_id).addClass("active")})}}let gameMachineEditor=null;function onEditorTabChange(t){gameMachineEditor.changeTab(t)}function onEditorRun(){if(gameMachineEditor.hasCompiler()){var t="";gameMachineEditor.programmingLanguage===gameMachineEditor.data.c?t="main.c":gameMachineEditor.programmingLanguage===gameMachineEditor.data.js?t="main.js":gameMachineEditor.programmingLanguage===gameMachineEditor.data.python&&(t="main.py"),writeFile(t,gameMachineEditor.editor.getValue()),gameMachineEditor.run()}else onDownloadPrompt(gameMachineEditor.getProgrammingLanguage())}function onDownloadPrompt(t){$("#downloadModal").modal({focus:!0,show:!0})}function onDownloadPromptAccept(){gameMachineEditor.download()}function onBeginBuildingAnimation(){var t=document.getElementById("run-btn");t.blur(),t.classList.add("animated","rotateIn"),t.classList.add("animation-duration","30s"),t.classList.add("animation-delay","30s"),t.classList.add("animation-iteration-count","infinite");var a=document.getElementById("run-btn-glyph");a.classList.remove("fa-play"),a.classList.add("fa-hammer")}function onBeginDownloadAnimation(){var t=document.getElementById("run-btn");t.blur(),t.classList.add("animated","fadeIn"),t.classList.add("animation-duration","30s"),t.classList.add("animation-delay","30s"),t.classList.add("animation-iteration-count","infinite");var a=document.getElementById("run-btn-glyph");a.classList.remove("fa-play"),a.classList.add("fa-angle-double-down")}function onEndAnimation(){var t=document.getElementById("run-btn");t.blur(),t.classList.remove("animated","rotateIn","fadeIn"),t.classList.remove("animation-iteration-count");var a=document.getElementById("run-btn-glyph");a.classList.remove("fa-hammer"),a.classList.add("fa-play")}function sleep(t){return new Promise(a=>setTimeout(a,t))}async function waitForExecution(){for(;""!==document.getElementById("iframe-shell").contentWindow.that.wapm.wasmTerminal.wasmTty._input;)await sleep(1e3)}function cleanBuildFiles(t){t.forEach(t=>{try{document.getElementById("iframe-shell").contentWindow.that.wasmFs.fs.unlinkSync(t)}catch(t){}})}async function writeFile(t,a){try{document.getElementById("iframe-shell").contentWindow.that.wasmFs.fs.writeFileSync(t,a)}catch(t){alert(t)}}async function execute(t){document.getElementById("iframe-shell").contentWindow.that.wasmTerminal.runCommand(t),await waitForExecution()}function BindWasmTerminal(t){that=t}!function(){"use strict";window.onload=function(){require.config({paths:{vs:"machine/js/min/vs"}}),require(["vs/editor/editor.main"],function(){gameMachineEditor=new GameMachineEditor})}}(),$("#downloadModal").on("show.bs.modal",function(t){$(this).find("#model-body-content").text("- "+gameMachineEditor.getProgrammingLanguage()+" programming language")});